# Wallet Creation Flow - Birthday Block Fix

## Issue Identified
The app wasn't showing the birthday block because of a flow issue:
1. UI generates 24 words using BIP39
2. Passes those words to `createWallet()`
3. Code was treating it as a restore operation (using provided seed)
4. Birthday wasn't being captured from Rust

## Solution Implemented
Modified the wallet creation flow to properly use Rust Bridge for new wallets:

### Changes Made

1. **Added `isNewWallet` parameter** to `createWallet()`:
   ```dart
   Future<void> createWallet(String seedPhrase, {
     AuthProvider? authProvider, 
     bool isNewWallet = true  // New parameter
   })
   ```

2. **Updated logic to use Rust for new wallets**:
   - When `isNewWallet = true`, ignore UI-generated seed
   - Let Rust generate the seed phrase and birthday
   - This ensures we get the birthday block

3. **Added logging** to track the flow:
   ```
   ü¶Ä Creating new wallet via Rust Bridge...
      Note: Ignoring UI seed phrase, will use Rust-generated seed
   ‚úÖ New wallet created with seed phrase from Rust
      Birthday: [block number]
   ```

## How It Works Now

### New Wallet Creation:
1. UI shows seed phrase screen (but this is temporary)
2. When user confirms, calls `createWallet(seedPhrase, isNewWallet: true)`
3. Code ignores the UI seed and uses Rust to generate:
   - Real seed phrase
   - Birthday block (current height - 100)
4. Birthday is properly captured and stored

### Wallet Restoration:
1. User enters their seed phrase
2. Calls `restoreWallet(seedPhrase)`
3. Uses the provided seed phrase
4. Birthday set to 0 (scans from genesis)

## Testing Instructions

1. **Clean start**:
   ```bash
   ./delete_wallet_data.sh
   ```

2. **Run the app**:
   ```bash
   flutter run -d macos
   ```

3. **Create new wallet**:
   - Click "Create New Wallet"
   - Go through seed phrase screens
   - Watch console for birthday logs

4. **Expected logs**:
   ```
   üèóÔ∏è WalletProvider.createWallet() starting...
     seedPhrase provided: true
     isNewWallet: true
   ü¶Ä Creating new wallet via Rust Bridge...
     Note: Ignoring UI seed phrase, will use Rust-generated seed
   üìù Creating new wallet via Rust...
     Server: https://lightd.btcz.rocks:9067
   ‚úÖ New wallet created
     Seed phrase: 24 words
     Birthday block: 2803550
     Latest block: 2803650
   üì± Wallet initialized successfully:
     walletId: [uuid]
     birthday block: 2803550
   ```

## Important Notes

### UI Seed vs Rust Seed
Currently, the UI generates and shows a seed phrase, but we ignore it and use the Rust-generated one. This is temporary - ideally, we should:
1. Either use the UI seed and pass it to Rust
2. Or get the seed from Rust first and display it

### Birthday Storage
The birthday is now properly:
- Generated by Rust (current block - 100)
- Stored in `WalletModel`
- Logged for verification
- Used for efficient wallet restoration

## Next Steps

1. **Fix UI flow**: Either use UI seed or get seed from Rust first
2. **Display birthday**: Show birthday block in wallet details
3. **Use birthday for restore**: Allow users to enter birthday when restoring

## Status
‚úÖ **FIXED** - Birthday block is now properly captured when creating new wallets via Rust Bridge.